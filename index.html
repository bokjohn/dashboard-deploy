<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jon & Sean - Mission Control</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .content-wrapper { margin-left: 0 !important; }
        .main-sidebar { display: none; }
        .brand-link { display: none; }
        body { font-size: 14px; }
        .small-box { cursor: pointer; transition: all 0.2s; }
        .small-box:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .todo-item { 
            padding: 12px;
            border-left: 4px solid #007bff;
            margin-bottom: 10px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
        }
        .todo-item:hover { background: #e9ecef; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .todo-item.done { 
            opacity: 0.6;
            background: #d4edda;
            border-left-color: #28a745;
        }
        .todo-item.done .todo-title { text-decoration: line-through; }
        .todo-item.sean { border-left-color: #28a745; }
        .todo-item.jon { border-left-color: #007bff; }
        .todo-item.urgent { 
            border-left-color: #dc3545; 
            background: #fff3cd;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.85; } }
        .todo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .todo-title { font-weight: bold; font-size: 15px; margin-bottom: 4px; }
        .todo-summary { font-size: 13px; color: #6c757d; }
        .checkbox { 
            font-size: 20px;
            color: #28a745;
            min-width: 24px;
        }
        .todo-details { 
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid #dee2e6;
            font-size: 13px;
            line-height: 1.6;
        }
        .todo-item.expanded .todo-details { display: block; }
        .todo-step { 
            margin: 8px 0;
            padding-left: 8px;
        }
        .todo-meta {
            margin-top: 12px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 12px;
        }
        .project-card {
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 15px;
        }
        .project-card:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .project-card.status-green { border-left: 5px solid #28a745; }
        .project-card.status-yellow { border-left: 5px solid #ffc107; }
        .project-card.status-red { border-left: 5px solid #dc3545; }
        .project-details {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #dee2e6;
        }
        .project-card.expanded .project-details { display: block; }
        .milestone {
            padding: 6px 10px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .milestone.done { background: #d4edda; }
        .milestone.done .milestone-name { text-decoration: line-through; opacity: 0.7; }
        .blocker {
            padding: 8px;
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            margin: 6px 0;
            border-radius: 4px;
            font-size: 13px;
        }
        .back-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: #007bff;
            color: white;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 1000;
            font-size: 24px;
        }
        .back-btn:hover { background: #0056b3; }
        .back-btn.show { display: flex; }
        .quick-link { 
            display: inline-block;
            padding: 6px 12px;
            margin: 4px;
            background: #e9ecef;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quick-link:hover { background: #007bff; color: white; }
    </style>
</head>
<body class="hold-transition layout-top-nav">
    <div class="wrapper">
        <nav class="main-header navbar navbar-expand-md navbar-light navbar-white">
            <div class="container">
                <span class="navbar-brand">
                    <i class="fas fa-rocket"></i>
                    <strong>Mission Control</strong>
                </span>
                <div class="navbar-nav ml-auto">
                    <span class="nav-item">
                        <small class="text-muted">Updated: <span id="lastUpdate">Loading...</span></small>
                    </span>
                </div>
            </div>
        </nav>

        <div class="content-wrapper" style="padding: 15px;">
            <div class="container-fluid">
                <!-- Overview Cards -->
                <div class="row mb-3" id="overview">
                    <div class="col-6 col-md-3">
                        <div class="small-box bg-info" onclick="scrollTo('#projects-section')">
                            <div class="inner">
                                <h3 id="activeProjects">0</h3>
                                <p>Active Projects</p>
                            </div>
                            <div class="icon"><i class="fas fa-tasks"></i></div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="small-box bg-success" onclick="scrollTo('#todos-section')">
                            <div class="inner">
                                <h3 id="completedTasks">0</h3>
                                <p>Completed</p>
                            </div>
                            <div class="icon"><i class="fas fa-check"></i></div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="small-box bg-warning" onclick="scrollTo('#todos-section')">
                            <div class="inner">
                                <h3 id="pendingTasks">0</h3>
                                <p>Pending</p>
                            </div>
                            <div class="icon"><i class="fas fa-clock"></i></div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="small-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <div class="inner">
                                <h3 id="monthlyTarget">$0</h3>
                                <p>Monthly Target</p>
                            </div>
                            <div class="icon"><i class="fas fa-dollar-sign"></i></div>
                        </div>
                    </div>
                </div>

                <!-- Todos Section -->
                <div class="row mb-3" id="todos-section">
                    <div class="col-12 col-md-6">
                        <div class="card">
                            <div class="card-header bg-success">
                                <h3 class="card-title"><i class="fas fa-user"></i> Sean's Todos</h3>
                            </div>
                            <div class="card-body p-2" id="seanTodos"></div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title"><i class="fas fa-robot"></i> Jon's Tasks</h3>
                            </div>
                            <div class="card-body p-2" id="jonTodos"></div>
                        </div>
                    </div>
                </div>

                <!-- Projects Section -->
                <div class="row mb-3" id="projects-section">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h3 class="card-title"><i class="fas fa-project-diagram"></i> Active Projects</h3>
                            </div>
                            <div class="card-body" id="projectsContainer"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <div class="back-btn" id="backBtn" onclick="scrollTo('#overview')">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
    <script>
        let data = null;

        // Load data
        async function loadData() {
            try {
                // Add cache buster to force fresh data
                const cacheBuster = '?t=' + new Date().getTime();
                const response = await fetch('data.json' + cacheBuster);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                data = await response.json();
                renderDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                const updateEl = document.getElementById('lastUpdate');
                if (updateEl) {
                    updateEl.textContent = 'Error: ' + error.message;
                }
                // Show error in alert box too
                alert('Dashboard failed to load data:\n' + error.message + '\n\nTry refreshing the page.');
            }
        }

        // Render dashboard
        function renderDashboard() {
            if (!data) return;

            // Update stats
            document.getElementById('activeProjects').textContent = data.stats.activeProjects;
            document.getElementById('monthlyTarget').textContent = data.stats.monthlyTarget;
            
            // Update last update time
            const lastUpdate = new Date(data.lastUpdate);
            document.getElementById('lastUpdate').textContent = lastUpdate.toLocaleString();

            // Render todos
            renderTodos('sean', data.todos.sean, document.getElementById('seanTodos'));
            renderTodos('jon', data.todos.jon, document.getElementById('jonTodos'));

            // Render projects
            renderProjects(data.projects);

            // Load saved state
            loadState();
            updateCounts();
        }

        // Render todos
        function renderTodos(owner, todos, container) {
            container.innerHTML = todos.map(todo => `
                <div class="todo-item ${owner} ${todo.priority === 'urgent' ? 'urgent' : ''}" data-id="${todo.id}">
                    <div class="todo-header">
                        <div style="flex: 1;">
                            <div class="todo-title">${todo.title}</div>
                            <div class="todo-summary">${todo.summary}</div>
                        </div>
                        <div class="checkbox">
                            <i class="far fa-square"></i>
                        </div>
                    </div>
                    <div class="todo-details">
                        <strong>üìã How to do this:</strong>
                        ${todo.steps.map(step => `<div class="todo-step">${step}</div>`).join('')}
                        ${todo.why ? `<div class="todo-meta"><strong>üí° Why:</strong> ${todo.why}</div>` : ''}
                        ${todo.blocksWhat ? `<div class="todo-meta"><strong>üö´ Blocks:</strong> ${todo.blocksWhat}</div>` : ''}
                        ${todo.alternatives ? `<div class="todo-meta"><strong>üîÑ Alternatives:</strong> ${todo.alternatives}</div>` : ''}
                        ${todo.impact ? `<div class="todo-meta"><strong>üéØ Impact:</strong> ${todo.impact}</div>` : ''}
                    </div>
                </div>
            `).join('');

            // Add click handlers
            container.querySelectorAll('.todo-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (e.target.closest('.checkbox')) {
                        toggleDone(item);
                    } else {
                        toggleExpanded(item);
                    }
                });
            });
        }

        // Render projects
        function renderProjects(projects) {
            const container = document.getElementById('projectsContainer');
            container.innerHTML = projects.map(project => `
                <div class="project-card card status-${project.status}" data-id="${project.id}">
                    <div class="card-body">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h5 style="margin: 0;">${project.name}</h5>
                            <span class="badge badge-${project.status === 'green' ? 'success' : project.status === 'yellow' ? 'warning' : 'danger'}">
                                ${project.completion}%
                            </span>
                        </div>
                        <div class="progress mt-2" style="height: 10px;">
                            <div class="progress-bar bg-${project.status === 'green' ? 'success' : project.status === 'yellow' ? 'warning' : 'danger'}" 
                                 style="width: ${project.completion}%"></div>
                        </div>
                        <p class="mt-2 mb-0"><small><strong>Next:</strong> ${project.nextStep}</small></p>
                        
                        <div class="project-details">
                            <hr>
                            <p style="font-size: 14px;">${project.details}</p>
                            
                            <strong>üìä Milestones:</strong>
                            <div class="mt-2">
                                ${project.milestones.map(m => `
                                    <div class="milestone ${m.done ? 'done' : ''}">
                                        <span class="milestone-name">
                                            ${m.done ? '‚úÖ' : '‚è≥'} ${m.name}
                                            ${m.progress ? ` (${m.progress}%)` : ''}
                                        </span>
                                        ${m.blocker ? `<span class="badge badge-warning">${m.blocker}</span>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            ${project.blockers.length > 0 ? `
                                <div class="mt-3">
                                    <strong>üö´ Current Blockers:</strong>
                                    ${project.blockers.map(b => `<div class="blocker">‚ö†Ô∏è ${b}</div>`).join('')}
                                </div>
                            ` : ''}
                            
                            <div class="mt-3">
                                <small class="text-muted"><strong>Timeline:</strong> ${project.timeline}</small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Add click handlers
            container.querySelectorAll('.project-card').forEach(card => {
                card.addEventListener('click', function() {
                    this.classList.toggle('expanded');
                });
            });
        }

        // Toggle functions
        function toggleDone(item) {
            item.classList.toggle('done');
            const checkbox = item.querySelector('.checkbox i');
            checkbox.className = item.classList.contains('done') ? 'fas fa-check-square' : 'far fa-square';
            saveState();
            updateCounts();
        }

        function toggleExpanded(item) {
            item.classList.toggle('expanded');
        }

        // State management
        function loadState() {
            const saved = localStorage.getItem('todoState');
            if (saved) {
                const state = JSON.parse(saved);
                Object.keys(state).forEach(id => {
                    const item = document.querySelector(`[data-id="${id}"]`);
                    if (item && state[id].done) {
                        item.classList.add('done');
                        item.querySelector('.checkbox i').className = 'fas fa-check-square';
                    }
                });
            }
        }

        function saveState() {
            const state = {};
            document.querySelectorAll('.todo-item').forEach(item => {
                state[item.dataset.id] = { done: item.classList.contains('done') };
            });
            localStorage.setItem('todoState', JSON.stringify(state));
        }

        function updateCounts() {
            if (!data) return;
            const allTodos = [...data.todos.sean, ...data.todos.jon];
            const total = allTodos.length;
            const doneItems = document.querySelectorAll('.todo-item.done').length;
            
            document.getElementById('completedTasks').textContent = doneItems;
            document.getElementById('pendingTasks').textContent = total - doneItems;
        }

        // Smooth scroll
        function scrollTo(selector) {
            document.querySelector(selector).scrollIntoView({ behavior: 'smooth' });
        }

        // Show back button on scroll
        window.addEventListener('scroll', function() {
            const btn = document.getElementById('backBtn');
            if (window.scrollY > 300) {
                btn.classList.add('show');
            } else {
                btn.classList.remove('show');
            }
        });

        // Initialize
        loadData();
    </script>
</body>
</html>
